# Программируем нейронные сети в android

### Пример использования машинного обучения с TensorFlow на платформе Android

Как многим известно, у Google есть открытая библиотека под названием TensorFlow, которая может использоваться для внедрения машинного обучения.

Я долго искал в Интернете, но так и не нашёл простого способа или примера для интеграции TensorFlow с Android. Но обойдя множество ресурсов, мне всё-таки удалось сделать это. Надеюсь эта статья сэкономит кучу времени другим людям.

Примечание: Пример классификатора был взят из Google TensorFlow examples.

Эта статья предназначена для тех, кто уже знаком с машинным обучением и знает, как собирать модели машинного обучения (в статье используется предварительно подготовленная модель). 

### Давайте начнем процесс сборки для Android.

Несколько важных вещей, которые мы должны знать:

+ TensorFlow написан на c++.
+ Для того, чтобы разрабатывать для Android, нам нужно использовать JNI (Java Native Interface) для вызова функций c++ таких, как loadModel, getPredictions и т. д.
+ Мы создадим файл .so (shared object), который является скомпилированным файлом c++ и файл jar, состоящий из JAVA API, которое будет вызывать c++.
+ Итак, нам нужны jar (Java API) и .so (c++ собранный) файл.
+ Нам нужен предварительно подготовленный файл модели и файл меток для классификации.



### Итак, давайте создадим файлы jar и .so.
+    git clone --recurse-subodules https://github.com/tensorflow/tensorflow.git


+ Скачайте NDK [тут](https://developer.android.com/ndk/downloads/older_releases.html#ndk-12b-downloads) .

+ Скачайте Android SDK.

+ Установите Bazel [отсюда](https://bazel.build/versions/master/docs/install.html). Bazel - это основная система сборки для TensorFlow.

Теперь отредактируйте WORKSPACE, файл WORKSPACE находится в корневом каталоге TensorFlow, который мы клонировали ранее:
![1](https://raw.githubusercontent.com/tom99991/2/master/1.png)

Приведите файл к такому виду:
![2](https://raw.githubusercontent.com/tom99991/2/master/2.png)

Затем создайте файл .so.

![3](https://raw.githubusercontent.com/tom99991/2/master/3.png)

Замените armeabi-v7a на нашу нужную архитектуру.

Библиотека будет расположена по адресу:
![4](https://raw.githubusercontent.com/tom99991/2/master/4.png)
Для создания копии Java:
![5](https://raw.githubusercontent.com/tom99991/2/master/5.png)

Мы можем найти файл JAR по адресу:
![6](https://raw.githubusercontent.com/tom99991/2/master/6.png)

Теперь у нас есть файлы jar и .so. Вы можете использовать готовые файлы из приведенного ниже проекта.

Пример рабочего приложения находится [здесь](https://github.com/MindorksOpenSource/AndroidTensorFlowMachineLearningExample).

Теперь нам нужна предварительно подготовленная модель и файл меток.

В этом примере мы будем использовать предварительно подготовленную модель от Google, которая выполняет обнаружение объекта на заданном изображении.

Вы можете скачать модель [здесь](https://storage.googleapis.com/download.tensorflow.org/models/inception5h.zip) .

Распакуйте этот zip-архив и вы получите файлы imagenet_comp_graph_label_strings.txt (метка для объектов) и tensorflow_inception_graph.pb (предварительно натренированная модель).

Теперь создайте новый проект в Android Studio.

Поместите imagenet_comp_graph_label_strings.txt и tensorflow_inception_graph.pb в папку с активами.

Поместите libandroid_tensorflow_inference_java.jar в папку libs и щелкните правой кнопкой мыши и добавьте в качестве библиотеки.

    compile files('libs/libandroid_tensorflow_inference_java.jar')

Создайте папку jniLibs в основном каталоге и поместите libtensorflow_inference.so в папку jniLibs/armeabi-v7a/ 

Теперь мы можем вызвать TensorFlow Java API.

TensorFlow Java API раскрывает все необходимые методы через класс TensorFlowInferenceInterface

Теперь вызываем API-интерфейс TensorFlow Java с путём к модели и загружаем.

В результате мы можем скормить нашей сети изображение и получить прогноз.

Чтобы протестировать, как это работает, клонируйте [проект](https://github.com/MindorksOpenSource/AndroidTensorFlowMachineLearningExample), соберите и запустите.
